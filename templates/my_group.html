<!-- templates/my_group.html -->

{% extends "base.html" %}

{% block content %}
<div class="group-container">
    <h2>Моя группа: {{ group_name }}</h2>

    <h3>Участники группы</h3>
    <table>
        <thead>
            <tr>
                <th>№</th>
                <th>Имя</th>
                <th>Номер телефона</th>
                <th>Город</th>
                <th>Дата рождения</th>
                <th>Год поступления</th>
            </tr>
        </thead>
        <tbody>
        {% for member in members %}
            <tr>
                <td>{{ loop.index }}</td>
                <td><a href="{{ url_for('student_details', student_id=member[0]) }}">{{ member[2] }}</a></td> <!-- display_name -->
                <td>{{ member[3] if member[3] else 'Не указано' }}</td> <!-- phone -->
                <td>{{ member[4] if member[4] else 'Не указано' }}</td> <!-- city -->
                <td>{{ member[5].strftime('%Y-%m-%d') if member[5] else 'Не указано' }}</td> <!-- date_of_birth -->
                <td>{{ member[6] if member[6] else 'Не указано' }}</td> <!-- admission_year -->
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <h3>Поиск студента по ID</h3>
    <form id="searchForm" class="form-inline">
        <label for="searchId">ID студента:</label>
        <input type="number" id="searchId" required>
        <button type="submit" class="btn">Найти</button>
    </form>
    <div id="searchResult"></div>
</div>

<script>
document.getElementById('searchForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const studentId = document.getElementById('searchId').value.trim();

    if (!studentId) {
        alert("Пожалуйста, введите ID студента.");
        return;
    }

    fetch(`/student/${studentId}`, {
        method: 'GET',
        headers: {
            'Accept': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('searchResult');
        if (data.success) {
            const student = data.student;
            resultDiv.innerHTML = `
                <div class="student-details">
                    <h4>Детали студента</h4>
                    <p><strong>ID:</strong> ${student.id}</p>
                    <p><strong>Имя:</strong> ${student.display_name}</p>
                    <p><strong>Номер телефона:</strong> ${student.phone || 'Не указано'}</p>
                    <p><strong>Город:</strong> ${student.city || 'Не указано'}</p>
                    <p><strong>Дата рождения:</strong> ${student.date_of_birth || 'Не указано'}</p>
                    <p><strong>Год поступления:</strong> ${student.admission_year || 'Не указано'}</p>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `<p class="error">${data.message}</p>`;
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
    });
});
</script>
{% endblock %}
