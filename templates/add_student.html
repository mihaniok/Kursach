<!-- templates/add_student.html -->

{% extends "base.html" %}

{% block content %}
<h2>Добавить студента</h2>
<form id="addStudentForm" method="POST">
    {{ form.hidden_tag() }}
    <p>
        {{ form.name.label }}<br>
        {{ form.name(size=32) }}
    </p>
    <p>
        {{ form.group.label }}<br>
        {{ form.group(size=32) }}
    </p>
    <p>{{ form.submit() }}</p>
</form>

<div id="addStudentResult"></div>

<script>
// Обработчик формы добавления студента через AJAX
document.getElementById('addStudentForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const name = document.getElementById('name').value.trim();
    const group = document.getElementById('group').value.trim();

    if (!name || !group) {
        alert("Пожалуйста, заполните все поля.");
        return;
    }

    fetch('{{ url_for("add_student") }}', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ form.csrf_token._value() }}'  // Используем CSRF токен из формы
        },
        body: JSON.stringify({ name: name, group: group })
    })
    .then(response => response.json())
    .then(data => {
        const resultDiv = document.getElementById('addStudentResult');
        if (data.success) {
            resultDiv.innerHTML = `<p>Студент добавлен с ID ${data.id}</p>`;
            document.getElementById('addStudentForm').reset();
        } else {
            resultDiv.innerHTML = `<p>${data.message}</p>`;
        }
    })
    .catch(error => {
        console.error('Ошибка:', error);
    });
});
</script>
{% endblock %}
